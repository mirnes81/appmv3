# API v1 - MV3 PRO Portail
# Protection et configuration

# Activer le moteur de réécriture
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /custom/mv3pro_portail/api/v1/

    # Bloquer l'accès direct au bootstrap
    RewriteRule ^_bootstrap\.php$ - [F,L]
</IfModule>

# Headers de sécurité
<IfModule mod_headers.c>
    # Désactiver l'affichage des erreurs PHP
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "DENY"
    Header set X-XSS-Protection "1; mode=block"
</IfModule>

# Bloquer l'accès aux fichiers sensibles
<FilesMatch "^(_.*|\.htaccess|\.git.*)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Limiter aux méthodes HTTP autorisées
<LimitExcept GET POST PUT DELETE OPTIONS>
    Order allow,deny
    Deny from all
</LimitExcept>

# Activer la compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE text/json
</IfModule>

# Cache pour les réponses OPTIONS (preflight CORS)
<IfModule mod_headers.c>
    <FilesMatch "\.(php)$">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
    </FilesMatch>
</IfModule>
